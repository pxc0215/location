<!--pages/orderlist.wxml-->
<view class="order-list">
  <view class="order-item" wx:for="{{orders}}" wx:key="index">
    <view class="order-header" data-id="{{index}}" bind:tap="foldItem">
      <view class="arrow-wrapper">
        <image class="arrow-icon {{unfold[index] ? 'arrow-down' : ''}}" 
               src="../../asset/{{unfold[index] ? 'down_arrows.svg' : 'right_arrows.svg'}}" />
      </view>
      <image class="order-image" mode="aspectFill" src="{{item.files[0].id}}" />
      <view class="order-info">
        <view class="address-text">{{item.address}}</view>
        <view class="bottom-info">
          <text class="user-name">{{item.ownername}}</text>
          <text class="order-time">{{item.createTime}}</text>
        </view>
      </view>
    </view>
    <view class="order-detail {{unfold[index] ? 'show' : ''}}" wx:if="{{unfold[index]}}">
      <view class="status-timeline">
        <!-- 创建状态 -->
        <view class="status-item create">
          <view class="status-icon"></view>
          <view class="status-content">
            <text class="status-type">创建</text>
            <text class="status-user">{{item.ownername}}</text>
            <text class="status-time">{{item.createTime}}</text>
          </view>
        </view>
        
        <!-- 流转状态 -->
        <view class="status-item flow" wx:for="{{item.flowRecords}}" wx:key="timestamp" wx:for-item="record">
          <view class="status-icon"></view>
          <view class="status-content">
            <text class="status-type">流转</text>
            <text class="status-user">{{record.userName}}</text>
            <text class="status-time">{{record.time}}</text>
          </view>
        </view>

        <!-- 归档状态 -->
        <view class="status-item archive" wx:if="{{item.archived}}">
          <view class="status-icon"></view>
          <view class="status-content">
            <text class="status-type">归档</text>
            <text class="status-user">{{item.archiveUser}}</text>
            <text class="status-time">{{item.archiveTime}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>